export const title = 'ä½¿ç”¨ useOptimistic è®©ä½ çš„åº”ç”¨æ„Ÿè§‰å³æ—¶å“åº”'
export const description = 'useOptimistic æ˜¯ä¸€ä¸ª React Hookï¼Œå¯ä»¥è®©ä½ å¿«é€Ÿå“åº”ç”¨æˆ·æ“ä½œï¼Œè®©åº”ç”¨æ„Ÿè§‰å³æ—¶å“åº”ã€‚'
export const publishedAt = '2025-07-20'
export const image = '/articles/use-optimistic.webp'

å½“ä½ åœ¨åº”ç”¨ä¸­ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®æ—¶ï¼ŒUI éœ€è¦å¤šé•¿æ—¶é—´æ‰èƒ½å“åº”ï¼Ÿå¦‚æœä½ åœ¨æ˜¾ç¤ºç»“æœä¹‹å‰ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆï¼Œä½ çš„ç”¨æˆ·å¯èƒ½ä¼šç›¯ç€åŠ è½½åŠ¨ç”»ï¼Œæ€€ç–‘æ˜¯å¦å‘ç”Ÿäº†ä»€ä¹ˆã€‚

è¿™å°±æ˜¯**ä¹è§‚ UI**çš„ç”¨æ­¦ä¹‹åœ°ã€‚è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼šå‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œç«‹å³æ›´æ–° UIï¼Œè®©æœåŠ¡å™¨è·Ÿä¸Šã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œä½ æ€»æ˜¯å¯ä»¥å›æ»šã€‚ä½†å¤§å¤šæ•°æ—¶å€™ï¼Œä¸€åˆ‡é¡ºåˆ©â€”â€”ä½ çš„åº”ç”¨æ„Ÿè§‰é£å¿«ã€‚

React 19 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ Hookï¼Œ[`useOptimistic`](https://react.dev/reference/react/useOptimistic)ï¼Œä½¿è¿™ç§æ¨¡å¼æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´å®¹æ˜“ã€‚

## ä»€ä¹ˆæ˜¯ `useOptimistic`ï¼Ÿ

`useOptimistic` æ˜¯ä¸€ä¸ª React Hookï¼Œè®©ä½ åœ¨å¼‚æ­¥æ“ä½œè¿›è¡Œæ—¶æ˜¾ç¤ºä¸åŒçš„çŠ¶æ€ã€‚å®ƒéå¸¸é€‚åˆè¿™æ ·çš„åœºæ™¯ï¼šå½“ç”¨æˆ·æäº¤è¡¨å•æ—¶ç«‹å³å°†æ–°é¡¹ç›®æ·»åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œè®©ä»–ä»¬å¯ä»¥å¿«é€Ÿæ·»åŠ å¦ä¸€ä¸ªé¡¹ç›®ï¼Œç”šè‡³åœ¨é¡¹ç›®å®é™…ä¿å­˜ä¹‹å‰æ›´æ”¹åˆ—è¡¨é¡¹ã€‚ä½ è¿˜å¯ä»¥å‘ç”¨æˆ·åé¦ˆä»–ä»¬çš„æ“ä½œæ­£åœ¨å¤„ç†ä¸­ï¼Œç”šè‡³æ›´æ–° UI ä»¥æ˜¾ç¤ºå„ä¸ªéƒ¨åˆ†çš„è¿›åº¦ã€‚ä¾‹å¦‚ï¼š"reserving your seat" => "creating calendar event" => "sending invitations" => "done"ã€‚

## ç¤ºä¾‹

### ä¹è§‚åœ°åˆ‡æ¢ç‚¹èµæŒ‰é’®

è®©æˆ‘ä»¬å°è¯•å¦ä¸€ä¸ªä¾‹å­ï¼šä¸€ä¸ª"Like"æŒ‰é’®ã€‚å½“ç”¨æˆ·ç‚¹å‡»å®ƒæ—¶ï¼Œä½ å¸Œæœ›è®¡æ•°ç«‹å³æ›´æ–°ã€‚

```tsx
import * as React from 'react'

function LikeButton({
  initialCount,
  sendLike,
}: {
  initialCount: number
  sendLike: () => Promise<void>
}) {
  const [isPending, startTransition] = React.useTransition()
  const [count, setCount] = React.useState(initialCount)

  // The update function adds the optimistic delta to the count
  const [optimisticCount, addOptimisticLike] = React.useOptimistic(
    count,
    (current, delta) => current + delta,
  )

  function handleLike() {
    // Optimistically increment the count
    addOptimisticLike(1)

    // Actually send to the server using the provided async function
    startTransition(async () => {
      await sendLike()
      setCount((c) => c + 1)
    })
  }

  return <button onClick={handleLike} disabled={isPending}>ğŸ‘ {optimisticCount}</button>
}
```

å³ä½¿ç”¨æˆ·çš„ç½‘ç»œå¾ˆæ…¢ï¼Œç”¨æˆ·ä¹Ÿä¼šçœ‹åˆ°ç‚¹èµæ•°ç«‹å³å¢åŠ ã€‚

### æ·»åŠ è¯„è®º

å‡è®¾ä½ æœ‰ä¸€ä¸ªè¯„è®ºéƒ¨åˆ†ã€‚å½“ç”¨æˆ·æäº¤æ–°è¯„è®ºæ—¶ï¼Œä½ å¸Œæœ›å®ƒç«‹å³å‡ºç°â€”â€”ç”šè‡³åœ¨æœåŠ¡å™¨å“åº”ä¹‹å‰ã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨ `useOptimistic` çš„å®ç°æ–¹å¼ï¼š

```tsx
import * as React from 'react'

type Comment = {
  id: number
  text: string
}

function CommentSection({
  initialComments,
  sendComment,
}: {
  initialComments: Comment[]
  sendComment: (text: string) => Promise<Comment>
}) {
  const [comments, setComments] = React.useState(initialComments)
  const [isPending, startTransition] = React.useTransition()

  // The update function merges the optimistic comment into the list
  const [optimisticComments, addOptimisticComment] = React.useOptimistic(
    comments,
    (currentComments, newComment) => [
      { ...newComment, optimistic: true },
      ...currentComments,
    ],
  )

  async function handleAddComment(text: string) {
    // Show the comment immediately
    addOptimisticComment({ id: Date.now(), text })

    // Actually send to the server using the provided async function
    startTransition(async () => {
      const savedComment = await sendComment(text)
      setComments((prev) => [{ ...savedComment }, ...prev])
    })
  }

  return (
    <fieldset disabled={isPending}>
      <form
        action={async (formData) => {
          handleAddComment(formData.get('text'))
        }}
      >
        <input name="text" placeholder="Write a comment..." />
        <button type="submit">Add</button>
      </form>
      <ul>
        {optimisticComments.map((comment) => (
          <li
            key={comment.id}
            className={comment.optimistic ? 'text-neutral-500' : ''}
          >
            {comment.text}
          </li>
        ))}
      </ul>
    </fieldset>
  )
}
```

æ³¨æ„æ–°è¯„è®ºå¦‚ä½•ç«‹å³å‡ºç°ï¼Œæ–‡æœ¬æ˜¾ç¤ºä¸ºç°è‰²ï¼Œç”šè‡³åœ¨æœåŠ¡å™¨å“åº”ä¹‹å‰ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼Œè¯„è®ºå°†åœ¨è½¬æ¢ç»“æŸæ—¶æ¶ˆå¤±ï¼ˆå¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼‰ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œä¹è§‚è¯„è®ºåœ¨è½¬æ¢ç»“æŸæ—¶ä»ç„¶ä¼šæ¶ˆå¤±ï¼Œä½†æ–°åˆ›å»ºçš„è¯„è®ºå°†å‡ºç°åœ¨å¸¸è§„è¯„è®ºåˆ—è¡¨ä¸­ï¼ˆå¹¶ä¸”ä¸å†æ˜¾ç¤ºä¸ºç°è‰²ï¼‰ã€‚

### é¢„è®¢èˆªç­

å‡è®¾ä½ æƒ³è®©ç”¨æˆ·é¢„è®¢èˆªç­ï¼Œå¹¶ä¸”ä½ æƒ³æ˜¾ç¤ºå¤šä¸ªæ­¥éª¤çš„è¿›åº¦â€”â€”æ¯”å¦‚"reserving seat"ã€"processing payment"å’Œ"sending confirmation"â€”â€”åŒæ—¶å¯¹é¢„è®¢çŠ¶æ€å’Œè¿›åº¦æ¶ˆæ¯è¿›è¡Œä¹è§‚çš„ UI æ›´æ–°ã€‚ä½ å¯ä»¥å°†æ‰€æœ‰å¼‚æ­¥é€»è¾‘å’Œæ­¥éª¤æ¶ˆæ¯ä½œä¸º props æ¥å—ï¼Œä½¿ç»„ä»¶çµæ´»ä¸”ä¸“æ³¨äº UI çŠ¶æ€ã€‚

```tsx
import * as React from 'react'
import { reserveSeat, processPayment, sendConfirmation } from './api'

function BookFlight() {
  const [message, setMessage] = React.useOptimistic('Ready to book')

  async function handleBooking(formData: FormData) {
    setMessage('Reserving seat...')
    await reserveSeat(formData.get('flight'))

    setMessage('Processing payment...')
    await processPayment(formData.get('passenger'))

    setMessage('Sending confirmation...')
    const bookingId = await sendConfirmation(
      formData.get('passenger'),
      formData.get('flight'),
    )

    setMessage('Booking complete! Redirecting...')
    // In a real app, you'd use your routing library here
    console.log(`Redirecting to /booking/${bookingId}`)
  }

  return (
    <form action={handleBooking}>
      <input name="passenger" placeholder="Passenger Name" required />
      <input name="flight" placeholder="Flight Number" required />
      <button type="submit">Book Flight</button>
      <div className="mt-2">
        <strong>Status:</strong> {message}
      </div>
    </form>
  )
}
```

è¿™ç§æ¨¡å¼è®©ä½ å¯ä»¥å°†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ä¿ç•™åœ¨ç»„ä»¶å¤–éƒ¨ï¼ŒåŒæ—¶ä»ç„¶ä¸ºç”¨æˆ·æä¾›ä¸°å¯Œçš„ã€é€æ­¥çš„ä¹è§‚ UI ä½“éªŒã€‚

## ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ `useState`ï¼Ÿ

ä½ å¯èƒ½æƒ³çŸ¥é“ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥æ›´æ–°çŠ¶æ€å¹¶å¸Œæœ›æœ€å¥½çš„ç»“æœï¼ŸåŒºåˆ«åœ¨äº `useOptimistic` æ—¨åœ¨ä¸ React çš„å¹¶å‘æ¸²æŸ“å’Œè½¬æ¢æ— ç¼åä½œã€‚å®ƒä½¿ä½ çš„ UI ä¸"çœŸå®"çŠ¶æ€ä¿æŒåŒæ­¥ï¼Œå¦‚æœæ“ä½œå¤±è´¥æˆ–å®Œæˆï¼Œå®ƒä¼šè‡ªåŠ¨å›é€€ã€‚

æ­¤å¤–ï¼Œç”±äº React è½¬æ¢çš„ç‰¹æ€§ï¼Œåœ¨è½¬æ¢ä¸­è°ƒç”¨ `setState` ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚

## ä½¿ç”¨ `useOptimistic` çš„æŠ€å·§

- **ä¿æŒæ›´æ–°å‡½æ•°çº¯å‡½æ•°ã€‚** å®ƒåº”è¯¥åªè®¡ç®—ä¸‹ä¸€ä¸ªä¹è§‚çŠ¶æ€ï¼Œä¸åº”è¯¥å¼•èµ·å‰¯ä½œç”¨ã€‚
- **ä¼˜é›…åœ°å¤„ç†é”™è¯¯ã€‚** å¦‚æœæœåŠ¡å™¨æ‹’ç»æ“ä½œï¼Œä½ å¯èƒ½æƒ³è¦æ˜¾ç¤ºé”™è¯¯æˆ–å›æ»šä¹è§‚æ›´æ–°ã€‚
- **ä¸ transition ä¸€èµ·ä½¿ç”¨ã€‚** å°† `useOptimistic` ä¸ `startTransition` é…å¯¹ä½¿ç”¨å¯ä»¥ç¡®ä¿ä½ çš„ UI ä¿æŒå“åº”ï¼Œå³ä½¿åœ¨å¼‚æ­¥å·¥ä½œæœŸé—´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

## ç»“è®º

ä¹è§‚ UI æ˜¯é‚£äº›å¯ä»¥è®©ä½ çš„åº”ç”¨æ„Ÿè§‰ç¥å¥‡çš„å°ç»†èŠ‚ä¹‹ä¸€ã€‚é€šè¿‡ `useOptimistic`ï¼ŒReact ä¸ºä½ æä¾›äº†ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„å·¥å…·ï¼Œè®©ä½ çš„ç•Œé¢æ„Ÿè§‰å³æ—¶å“åº”â€”â€”å³ä½¿ç½‘ç»œä¸ç†æƒ³ã€‚

æ‰€ä»¥ä¸‹æ¬¡ä½ åœ¨æ„å»ºè¡¨å•ã€ç‚¹èµæŒ‰é’®æˆ–ä»»ä½•ä¸æœåŠ¡å™¨é€šä¿¡çš„ä¸œè¥¿æ—¶ï¼Œè¯•è¯• `useOptimistic`ã€‚ä½ çš„ç”¨æˆ·ä¼šæ„Ÿè°¢ä½ çš„ã€‚
